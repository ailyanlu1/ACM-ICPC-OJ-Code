# 2010 Tokyo: Where's Wally

## Summary

给出两个二维01阵：image与pattern，要求找出pattern在image之中出现了多少次。pattern可以作九十度旋转，也可以镜像倒转。
## Solution

image的大小为h × w，而pattern的大小为p × p，可以考虑先进行Rabin Karp Hash，然后再进行KMP匹配的方法。具体实现是：

先把image的每一行看成一个字符串，把该字符串每p个位Hash成一个数字。也就是1到p位hash成一个数字，2到p+1位hash 成一个数字…………使用RK Hash对每一行进行操作，可以使复杂度为O(w)。对image每一行都这样处理后，我们得到一个h行，w-p+1列的二维数组，其中每个元素都是一个 数字。设该二维数组为h1[h][w-p+1]。

然后把pattern也这样进行Hash。那么得到一个“列向量”：pattern每一行都被Hash成一个数字，一共有p行。设该一维数 组为h2[p]。此时，如果h2[i] == h1[a][b]，就说明image之中第a行从第b个字符开始，与pattern的第i行完全匹配。因为h1[a][b]是由h1第a行的第b个字符到 第b+p-1个字符Hash而成的，代表了这些字符的信息。

然后就进入了最后一步，枚举h1的每一个列，抽出来，与h2进行KMP匹配。题目规定每个地方只能计算一次，因此如果发现匹配，那么必须记录下来哪个地方匹配了。累加匹配次数即可得到答案。

题目说pattern可以进行旋转、镜像等操作，可以把pattern进行旋转、镜像，然后再重复上述的部分步骤。

由于RK Hash是一个不确定的算法，存在一定的错误概率，可以通过二次HASH提高正确率。但由于以下代码使用一次Hash即AC了，因此没有采用更为保险的二次Hash方法。

该算法总复杂度为O(w*h)。 
