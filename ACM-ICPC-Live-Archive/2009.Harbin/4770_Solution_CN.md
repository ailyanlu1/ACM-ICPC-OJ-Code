# 2009 Harbin: Offset Recovery

## Solution
这道题的实际模型是：给定两个有序序列A和B，A中有n个元素，B中有m个元素。寻求一个最佳offset值x，使得在序列B的每个元素都加上x之 后，与A能够很好地对应。评价对应好坏的标准就是题中的那个公式，即B中每个元素移动后，与A中距它最近的元素的距离的平方和。称这一平方和为p，那么p 最小时对应得最好。

最朴素的方法是O(nm^2)的。即先将B整体移动到A的左边，然后逐渐向右移动，直至完全移到A的右边。在移动的过程中可以看到，B与A 中的元素的对应关系在逐渐发生变化。每当B中一个元素位于A中相邻两个元素的中点的时候，就可以看作是一个变化的时刻，此时与该元素对应的A中的元素，从 左边那个过渡到右边那个。因此，我们把所有的改变定义为“事件”，可见事件不超过nm个。不难发现，当移动发生在两个事件之间的时候，公式的形式没有任何 变化，并且是一个二次多项式。这意味着公式的变化当且仅当在遇到事件时发生，此时二次函数的系数会发生变化。如果事先知道A序列的某个元素对应到B序列的 哪个元素，那么可以在O(1)的时间内对二次函数的表达式进行修正。

因此可以得到如下算法：先把所有的事件点处理出来，并按照事件点发生的x坐标排序。然后对于每个分段的二次函数，计算其极值，更新最优答案 即可。 
