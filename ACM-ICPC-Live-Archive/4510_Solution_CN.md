# 2009 Southwestern Europe: Slalom
## Summary

有一个人滑雪，二维平面坐标上有n(n<=1000)个滑雪门，人从起点出发，必须按顺序从这些门之间穿过去，到达最后一个门。问此人从起点到最后一个门的最短距离是多少？

滑雪门使用Y x1 x2表示，表示其两个端点是(x1, Y), (x2, Y)。且保证给出的门是按Y递减的顺序给出的。人只能够从门中间通过，不能绕门而行。

## Solution

有一个结论：人滑雪的路线必定是由一些线段组成的。而且这些线段的端点必定是起点或者门的两个端点，并有可能有一条垂直于X轴的线段（最后一段，从 某个点直接滑到最后一个门）。

因此对于某端点（起点S或这门的端点）的PA和门B的端点PB（A.y > B.y），如果线段PA PB之间都经过其他门之内，就可以在有向图中连一条有向边。由于滑雪不会逆行回到前一个门，因此构造出来的图必定是一个DAG（有向无环图），可以使用DP求最短路。注意：如果一个点能够垂直到达最后一个门，那么就要检查到这个点的最短路加上垂直到达最后一个门的距离，与最优答案比较，并更新。

但要注意，由于题目的规模比较大，n达到1000，因此不能够枚举任意两个端点，再判断是否经过之间所有的门，这样的做法是O(n<sup>3</sup>)。因此需要有更加高效的方法来进行预处理。可以枚举某个点P，想象有一束光从这个点分散向下照射，下面的每个门相当一条能够通过光线的缝隙。对该点下面的线段逐条枚举，看看这束光线能够照射到下面的哪些线段端点。光线的左右范围可以使用两条射线的斜率的倒数保存（因为射线不可能平行于X轴，但是会平行于Y 轴，因此要用斜率的倒数）。如果这束光线能够照到最底下的门，那么就说明这个点能够直接垂直下到最小面的门，求最短路的时候要特判一下这种情况。 
